<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - Mental Health App</title>
  <link href="https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Gloria Hallelujah', cursive;
      background: url('assets/dreamy.jpeg') no-repeat center center fixed;
      background-size: cover;
      overflow-x: hidden;
      color: #fff;
      min-height: 100vh;
      padding-bottom: 100px;
    }

    /* Back arrow button */
    .back-icon {
      width: 60px;
      height: 60px;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1001;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .back-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      padding: 0;
      background: none;
      border: none;
      backdrop-filter: none;
    }

    .back-icon:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(255, 182, 255, 0.6);
    }

    .header-box {
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      font-family: 'Gloria Hallelujah', cursive;
      margin: 20px auto 30px;
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      width: fit-content;
      color: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .container {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .settings-section {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 20px;
      padding: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .section-title {
      font-size: 1.4rem;
      margin-bottom: 20px;
      color: #fff;
      text-align: center;
      border-bottom: 2px solid rgba(255, 255, 255, 0.3);
      padding-bottom: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #fff;
    }

    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      font-family: 'Gloria Hallelujah', cursive;
      backdrop-filter: blur(5px);
      box-sizing: border-box;
    }

    .form-group input::placeholder, .form-group textarea::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.3);
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #7aa3ff;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .theme-preview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .theme-option {
      padding: 10px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s ease;
      border: 2px solid transparent;
      background: rgba(255, 255, 255, 0.1);
    }

    .theme-option:hover {
      transform: scale(1.05);
    }

    .theme-option.active {
      border-color: #7aa3ff;
      background: rgba(122, 163, 255, 0.3);
    }

    .volume-slider {
      width: 100%;
      height: 8px;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.3);
      outline: none;
      -webkit-appearance: none;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #7aa3ff;
      cursor: pointer;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      backdrop-filter: blur(4px);
      font-family: 'Gloria Hallelujah', cursive;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 120px;
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .btn.danger {
      background: rgba(255, 100, 100, 0.3);
    }

    .btn.danger:hover {
      background: rgba(255, 100, 100, 0.5);
    }

    .save-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px 25px;
      background: #7aa3ff;
      color: white;
      border: none;
      border-radius: 50px;
      font-family: 'Gloria Hallelujah', cursive;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(122, 163, 255, 0.4);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .save-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(122, 163, 255, 0.6);
    }

    .profile-upload {
      text-align: center;
      margin-bottom: 20px;
    }

    .profile-pic {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      margin: 0 auto 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .profile-pic:hover {
      transform: scale(1.1);
    }

    @media (max-width: 768px) {
      .settings-grid {
        grid-template-columns: 1fr;
      }
      
      .container {
        padding: 10px;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      .btn {
        min-width: auto;
      }
    }
  </style>
</head>
<body>
  <a href="index.html" class="back-icon" title="Back to Main Page">
    <img src="assets/arrow.jpeg" alt="Back Icon" loading="lazy">
  </a>

  <div class="header-box">
    ‚öôÔ∏è <span>Settings</span> ‚öôÔ∏è
  </div>

  <div class="container">
    <div class="settings-grid">
      <!-- Account Settings -->
      <div class="settings-section">
        <h3 class="section-title">üë§ Account Settings</h3>
        <div class="profile-upload">
          <div class="profile-pic" onclick="document.getElementById('profilePic').click()">
            üì∑
          </div>
          <input type="file" id="profilePic" accept="image/*" style="display: none;">
          <p>Click to upload profile picture</p>
        </div>
        <div class="form-group">
          <label for="userName">Name</label>
          <input type="text" id="userName" placeholder="Your name">
        </div>
        <div class="form-group">
          <label for="userEmail">Email</label>
          <input type="email" id="userEmail" placeholder="your@email.com">
        </div>
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input type="password" id="currentPassword" placeholder="Current password">
        </div>
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input type="password" id="newPassword" placeholder="New password">
        </div>
        <div class="button-group">
          <button class="btn danger" onclick="deleteAccount()">Delete Account</button>
        </div>
      </div>

      <!-- Theme Settings -->
      <div class="settings-section">
        <h3 class="section-title">üé® Theme Settings</h3>
        <div class="theme-preview">
          <div class="theme-option active" data-theme="galaxy" onclick="selectTheme('galaxy')">üåå Galaxy</div>
          <div class="theme-option" data-theme="sakura" onclick="selectTheme('sakura')">üå∏ Sakura</div>
          <div class="theme-option" data-theme="pastel" onclick="selectTheme('pastel')">üå§Ô∏è Pastel</div>
          <div class="theme-option" data-theme="forest" onclick="selectTheme('forest')">üåø Forest</div>
          <div class="theme-option" data-theme="neon" onclick="selectTheme('neon')">üí´ Neon</div>
        </div>
      </div>


      <!-- Notification Settings -->
      <div class="settings-section">
        <h3 class="section-title">üîî Notification Settings</h3>
        <div class="form-group">
          <label>Daily Mood Reminders</label>
          <label class="toggle-switch">
            <input type="checkbox" id="moodReminders" checked onchange="toggleNotification('mood')">
            <span class="slider"></span>
          </label>
        </div>
        <div class="form-group">
          <label>Journal Reminders</label>
          <label class="toggle-switch">
            <input type="checkbox" id="journalReminders" checked onchange="toggleNotification('journal')">
            <span class="slider"></span>
          </label>
        </div>
        <div class="form-group">
          <label>Game Notifications</label>
          <label class="toggle-switch">
            <input type="checkbox" id="gameNotifications" onchange="toggleNotification('games')">
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <!-- Privacy Settings -->
      <div class="settings-section">
        <h3 class="section-title">üîí Privacy Settings</h3>
        <div class="form-group">
          <label>Journal Entries</label>
          <label class="toggle-switch">
            <input type="checkbox" id="privateJournal" checked onchange="togglePrivacy('journal')">
            <span class="slider"></span>
          </label>
          <small>Keep journal entries private</small>
        </div>
        <div class="form-group">
          <label>Data Sharing</label>
          <label class="toggle-switch">
            <input type="checkbox" id="dataSharing" onchange="togglePrivacy('sharing')">
            <span class="slider"></span>
          </label>
          <small>Allow anonymous usage data sharing</small>
        </div>
        <div class="button-group">
          <button class="btn" onclick="exportData()">Export Data</button>
        </div>
      </div>

      <!-- Sound Settings -->
      <div class="settings-section">
        <h3 class="section-title">üîä Sound Settings</h3>
        <div class="form-group">
          <label for="musicVolume">Background Music Volume</label>
          <input type="range" id="musicVolume" class="volume-slider" min="0" max="100" value="50" onchange="updateVolume('music')">
          <span id="musicVolumeValue">50%</span>
        </div>
        <div class="form-group">
          <label for="effectsVolume">Sound Effects Volume</label>
          <input type="range" id="effectsVolume" class="volume-slider" min="0" max="100" value="70" onchange="updateVolume('effects')">
          <span id="effectsVolumeValue">70%</span>
        </div>
      </div>

      <!-- Reset & Backup -->
      <div class="settings-section">
        <h3 class="section-title">üíæ Reset & Backup</h3>
        <div class="button-group">
          <button class="btn" onclick="backupData()">Backup Data</button>
          <button class="btn" onclick="restoreBackup()">Restore Backup</button>
          <button class="btn danger" onclick="resetApp()">Reset App</button>
        </div>
      </div>
    </div>
  </div>

  <button class="save-button" onclick="saveAllSettings()">üíæ Save Changes</button>

  <script>
    // Theme definitions
    const themes = {
      galaxy: {
        bg: 'linear-gradient(rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.5)), url("assets/dreamy.jpeg") no-repeat center center fixed',
        accent: '#7aa3ff'
      },
      sakura: {
        bg: 'linear-gradient(rgba(255, 182, 193, 0.4), rgba(255, 105, 180, 0.3)), url("assets/dreamy.jpeg") no-repeat center center fixed',
        accent: '#ffb6c1'
      },
      pastel: {
        bg: 'linear-gradient(rgba(173, 216, 230, 0.4), rgba(221, 160, 221, 0.3)), url("assets/dreamy.jpeg") no-repeat center center fixed',
        accent: '#dda0dd'
      },
      forest: {
        bg: 'linear-gradient(rgba(34, 139, 34, 0.4), rgba(46, 125, 50, 0.3)), url("assets/dreamy.jpeg") no-repeat center center fixed',
        accent: '#4caf50'
      },
      neon: {
        bg: 'linear-gradient(rgba(255, 20, 147, 0.4), rgba(138, 43, 226, 0.3)), url("assets/dreamy.jpeg") no-repeat center center fixed',
        accent: '#ff1493'
      }
    };

    // Global settings object
    let appSettings = {
      profile: { name: '', email: '', profilePic: null },
      theme: 'galaxy',
      language: 'en',
      notifications: { mood: true, journal: true, games: false },
      privacy: { journal: true, sharing: false },
      sound: { music: 50, effects: 70, muted: false }
    };

    // Initialize on load
    window.addEventListener('load', function() {
      loadSettings();
      applyCurrentTheme();
      
      // Initialize global audio if available
      if (typeof initGlobalAudio === 'function') {
        initGlobalAudio();
        updateGlobalAudioSettings(appSettings.sound);
      }
    });

    // Show notification with sound
    function showNotification(message) {
      if (typeof playGlobalSound === 'function') {
        playGlobalSound('success');
      }
      
      // Create custom notification
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(122, 163, 255, 0.9);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        z-index: 10000;
        font-family: 'Gloria Hallelujah', cursive;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        transform: translateX(100%);
        transition: transform 0.3s ease;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => notification.style.transform = 'translateX(0)', 100);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Profile Management
    function updateProfile() {
      const name = document.getElementById('userName').value;
      const email = document.getElementById('userEmail').value;
      
      if (!name || !email) {
        if (typeof playGlobalSound === 'function') playGlobalSound('error');
        showNotification('Please fill in all fields');
        return;
      }
      
      appSettings.profile.name = name;
      appSettings.profile.email = email;
      saveSettings();
      showNotification('Profile updated successfully!');
    }

    function changePassword() {
      const current = document.getElementById('currentPassword').value;
      const newPass = document.getElementById('newPassword').value;
      
      if (!current || !newPass) {
        if (typeof playGlobalSound === 'function') playGlobalSound('error');
        showNotification('Please enter both passwords');
        return;
      }
      
      showNotification('Password changed successfully!');
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
    }

    // Theme Management
    function selectTheme(theme) {
      if (typeof playGlobalSound === 'function') playGlobalSound('click');
      
      document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
      document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
      
      // Use global theme system
      if (typeof switchTheme === 'function') {
        switchTheme(theme);
      } else {
        // Fallback to local theme application
        appSettings.theme = theme;
        applyCurrentTheme();
        saveSettings();
      }
      
      showNotification(`${theme.charAt(0).toUpperCase() + theme.slice(1)} theme applied!`);
    }

    function applyCurrentTheme() {
      const themeConfig = themes[appSettings.theme];
      if (themeConfig) {
        document.body.style.background = themeConfig.bg;
        document.body.style.backgroundSize = 'cover';
        document.body.style.backgroundAttachment = 'fixed';
        document.documentElement.style.setProperty('--accent-color', themeConfig.accent);
        
        // Update slider colors
        document.querySelectorAll('.volume-slider::-webkit-slider-thumb').forEach(thumb => {
          thumb.style.background = themeConfig.accent;
        });
      }
    }

    // Language Management
    function changeLanguage() {
      if (typeof playGlobalSound === 'function') playGlobalSound('click');
      
      const language = document.getElementById('language').value;
      const languageNames = {
        'en': 'English',
        'es': 'Espa√±ol', 
        'fr': 'Fran√ßais',
        'de': 'Deutsch',
        'ja': 'Êó•Êú¨Ë™û',
        'zh': '‰∏≠Êñá'
      };
      
      // Use global language system
      if (typeof switchLanguage === 'function') {
        switchLanguage(language);
      } else {
        // Fallback to local language setting
        appSettings.language = language;
        saveSettings();
      }
      
      showNotification(`Language changed to ${languageNames[language]}`);
    }

    // Notification Management
    function toggleNotification(type) {
      if (typeof playGlobalSound === 'function') playGlobalSound('toggle');
      
      const checkbox = document.getElementById(`${type}Reminders`) || document.getElementById(`${type}Notifications`);
      if (checkbox) {
        appSettings.notifications[type] = checkbox.checked;
        saveSettings();
        showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} notifications ${checkbox.checked ? 'enabled' : 'disabled'}`);
      }
    }

    // Privacy Management
    function togglePrivacy(type) {
      if (typeof playGlobalSound === 'function') playGlobalSound('toggle');
      
      const checkbox = document.getElementById(type === 'journal' ? 'privateJournal' : 'dataSharing');
      if (checkbox) {
        appSettings.privacy[type === 'journal' ? 'journal' : 'sharing'] = checkbox.checked;
        saveSettings();
        showNotification('Privacy setting updated');
      }
    }

    function exportData() {
      if (typeof playGlobalSound === 'function') playGlobalSound('click');
      
      const allData = {
        settings: appSettings,
        journalEntries: JSON.parse(localStorage.getItem('journalEntries') || '[]'),
        whisperGarden: JSON.parse(localStorage.getItem('whisperGarden') || '[]'),
        timestamp: new Date().toISOString()
      };
      
      const dataStr = JSON.stringify(allData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `mental-health-app-export-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showNotification('Data exported successfully!');
    }

    function deleteAccount() {
      if (typeof playGlobalSound === 'function') playGlobalSound('click');
      
      if (confirm('‚ö†Ô∏è This will permanently delete ALL your data including:\n‚Ä¢ Journal entries\n‚Ä¢ Game progress\n‚Ä¢ Personal settings\n\nThis cannot be undone! Are you absolutely sure?')) {
        localStorage.clear();
        sessionStorage.clear();
        if (typeof playGlobalSound === 'function') playGlobalSound('error');
        showNotification('Account deleted. Redirecting...');
        setTimeout(() => window.location.href = 'index.html', 2000);
      }
    }

    // Sound Management
    function updateVolume(type) {
      const slider = document.getElementById(`${type}Volume`);
      const valueDisplay = document.getElementById(`${type}VolumeValue`);
      const value = slider.value;
      
      valueDisplay.textContent = value + '%';
      appSettings.sound[type] = parseInt(value);
      
      // Update global audio system if available
      if (typeof updateGlobalAudioSettings === 'function') {
        updateGlobalAudioSettings(appSettings.sound);
      }
      
      saveSettings();
    }

    // Backup & Reset
    function backupData() {
      if (typeof playGlobalSound === 'function') playGlobalSound('click');
      
      const backup = {
        settings: appSettings,
        journalEntries: JSON.parse(localStorage.getItem('journalEntries') || '[]'),
        whisperGarden: JSON.parse(localStorage.getItem('whisperGarden') || '[]'),
        timestamp: new Date().toISOString(),
        version: '1.0'
      };
      
      const dataStr = JSON.stringify(backup, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      
      showNotification('Backup created successfully!');
    }

    function restoreBackup() {
      if (typeof playGlobalSound === 'function') playGlobalSound('click');
      
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const backup = JSON.parse(e.target.result);
              if (backup.settings) {
                // Restore settings
                appSettings = backup.settings;
                localStorage.setItem('appSettings', JSON.stringify(appSettings));
                
                // Restore other data if available
                if (backup.journalEntries) {
                  localStorage.setItem('journalEntries', JSON.stringify(backup.journalEntries));
                }
                if (backup.whisperGarden) {
                  localStorage.setItem('whisperGarden', JSON.stringify(backup.whisperGarden));
                }
                
                showNotification('Backup restored successfully! Reloading...');
                setTimeout(() => location.reload(), 1500);
              } else {
                throw new Error('Invalid backup file');
              }
            } catch (error) {
              if (typeof playGlobalSound === 'function') playGlobalSound('error');
              showNotification('Error: Invalid backup file');
            }
          };
          reader.readAsText(file);
        }
      };
      
      input.click();
    }

    function resetApp() {
      if (typeof playGlobalSound === 'function') playGlobalSound('click');
      
      if (confirm('‚ö†Ô∏è This will reset ALL settings and delete ALL data including:\n‚Ä¢ Journal entries\n‚Ä¢ Game progress\n‚Ä¢ Personal settings\n\nThis cannot be undone! Are you sure?')) {
        localStorage.clear();
        sessionStorage.clear();
        if (typeof playGlobalSound === 'function') playGlobalSound('error');
        showNotification('App reset successfully! Reloading...');
        setTimeout(() => location.reload(), 1500);
      }
    }

    // Save/Load Settings
    function saveSettings() {
      localStorage.setItem('appSettings', JSON.stringify(appSettings));
    }

    function loadSettings() {
      const saved = localStorage.getItem('appSettings');
      if (saved) {
        try {
          const savedSettings = JSON.parse(saved);
          appSettings = { ...appSettings, ...savedSettings };
          
          // Load UI values
          if (appSettings.profile.name) document.getElementById('userName').value = appSettings.profile.name;
          if (appSettings.profile.email) document.getElementById('userEmail').value = appSettings.profile.email;
          if (appSettings.language) document.getElementById('language').value = appSettings.language;
          
          // Load theme
          document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
          const activeTheme = document.querySelector(`[data-theme="${appSettings.theme}"]`);
          if (activeTheme) activeTheme.classList.add('active');
          
          // Load toggles
          document.getElementById('moodReminders').checked = appSettings.notifications.mood;
          document.getElementById('journalReminders').checked = appSettings.notifications.journal;
          document.getElementById('gameNotifications').checked = appSettings.notifications.games;
          document.getElementById('privateJournal').checked = appSettings.privacy.journal;
          document.getElementById('dataSharing').checked = appSettings.privacy.sharing;
          
          // Load volumes
          document.getElementById('musicVolume').value = appSettings.sound.music;
          document.getElementById('effectsVolume').value = appSettings.sound.effects;
          document.getElementById('musicVolumeValue').textContent = appSettings.sound.music + '%';
          document.getElementById('effectsVolumeValue').textContent = appSettings.sound.effects + '%';
          
          // Load profile pic
          if (appSettings.profile.profilePic) {
            document.querySelector('.profile-pic').innerHTML = `<img src="${appSettings.profile.profilePic}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
          }
        } catch (error) {
          console.error('Error loading settings:', error);
        }
      }
    }

    function saveAllSettings() {
      // Update profile from form
      const name = document.getElementById('userName').value;
      const email = document.getElementById('userEmail').value;
      if (name) appSettings.profile.name = name;
      if (email) appSettings.profile.email = email;
      
      saveSettings();
      showNotification('All settings saved successfully!');
    }

    // Profile picture upload
    document.getElementById('profilePic').addEventListener('change', function(e) {
      if (e.target.files && e.target.files[0]) {
        const file = e.target.files[0];
        
        // Check file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          showNotification('Image too large. Please choose a file under 5MB.');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = new Image();
          img.onload = function() {
            // Create canvas to resize image
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const maxSize = 200;
            
            let { width, height } = img;
            if (width > height) {
              if (width > maxSize) {
                height = height * (maxSize / width);
                width = maxSize;
              }
            } else {
              if (height > maxSize) {
                width = width * (maxSize / height);
                height = maxSize;
              }
            }
            
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            
            const resizedDataUrl = canvas.toDataURL('image/jpeg', 0.8);
            document.querySelector('.profile-pic').innerHTML = `<img src="${resizedDataUrl}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            appSettings.profile.profilePic = resizedDataUrl;
            saveSettings();
            showNotification('Profile picture updated!');
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Volume sliders
      document.getElementById('musicVolume').addEventListener('input', () => updateVolume('music'));
      document.getElementById('effectsVolume').addEventListener('input', () => updateVolume('effects'));
      
      // Add click sounds to buttons
      document.querySelectorAll('button, .theme-option').forEach(element => {
        element.addEventListener('click', () => {
          if (typeof playGlobalSound === 'function') playGlobalSound('click');
        });
      });
      
      // Add toggle sounds to checkboxes
      document.querySelectorAll('input[type="checkbox"]').forEach(element => {
        element.addEventListener('change', () => {
          if (typeof playGlobalSound === 'function') playGlobalSound('toggle');
        });
      });
      
      // Auto-save on form changes
      document.querySelectorAll('input, select').forEach(element => {
        element.addEventListener('change', () => {
          setTimeout(saveSettings, 100); // Small delay to ensure value is updated
        });
      });
    });
  </script>
  <script src="script.js"></script>
</body>
</html>